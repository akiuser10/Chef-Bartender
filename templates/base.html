<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef & Bartender</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='CNB.png') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='CNB.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='CNB.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&family=Dancing+Script:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body data-user-role="{{ current_user.user_role if current_user.is_authenticated else '' }}">
    <!-- Sticky Site Header (Top Ribbon + Navigation) -->
    <header class="site-header">
        <div class="top-header">
            <div class="header-left">
                <img src="{{ url_for('static', filename='CNB.png') }}" alt="Logo" class="logo-ex">
            </div>
            <div class="header-right">
                <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <div class="dinex-text">CHEF & BARTENDER</div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="main-nav">
        <a href="{{ url_for('main.index') }}" class="nav-link">HOME</a>
        <a href="{{ url_for('products.ingredients_master') }}" class="nav-link">MASTER LIST</a>
        {% if current_user.is_authenticated and (current_user.user_role in ['Chef', 'Bartender', 'Manager', 'Purchase Manager', 'Cost Controller']) %}
        <div class="nav-dropdown-container">
            <span class="nav-link purchase-center-dropdown-trigger" id="purchaseCenterDropdownTrigger">PURCHASE CENTER</span>
            <div class="nav-dropdown-menu" id="purchaseCenterDropdownMenu">
                {% if current_user.user_role in ['Chef', 'Bartender', 'Manager'] %}
                <a href="{{ url_for('purchase.purchase') }}" class="nav-dropdown-item">Purchase Order</a>
                <a href="{{ url_for('purchase.order_list') }}" class="nav-dropdown-item">Order List</a>
                {% endif %}
                {% if current_user.user_role in ['Purchase Manager', 'Manager'] %}
                <a href="{{ url_for('purchase.to_order') }}" class="nav-dropdown-item">To Order</a>
                {% endif %}
                {% if current_user.user_role in ['Purchase Manager', 'Manager', 'Cost Controller'] %}
                <a href="{{ url_for('purchase.purchase_history') }}" class="nav-dropdown-item">Purchase History</a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% if current_user.is_authenticated and current_user.user_role not in ['Purchase Manager', 'Cost Controller'] %}
        <div class="nav-dropdown-container">
            <span class="nav-link recipe-center-dropdown-trigger" id="recipeCenterDropdownTrigger">RECIPE CENTER</span>
            <div class="nav-dropdown-menu" id="recipeCenterDropdownMenu">
                {% if current_user.user_role != 'Purchase Manager' %}
                <a href="{{ url_for('recipes.recipes_list') }}" class="nav-dropdown-item">Recipes</a>
                {% endif %}
                <a href="{{ url_for('secondary.secondary_ingredients') }}" class="nav-dropdown-item">Secondary Recipes</a>
            </div>
        </div>
        {% endif %}
        {% if current_user.is_authenticated and current_user.user_role in ['Chef', 'Bartender', 'Manager'] %}
        <div class="nav-dropdown-container">
            <span class="nav-link checklist-dropdown-trigger" id="checklistDropdownTrigger">CHECKLIST</span>
            <div class="nav-dropdown-menu" id="checklistDropdownMenu">
                {% if current_user.user_role in ['Manager', 'Bartender'] %}
                <a href="{{ url_for('checklist.bar_checklist') }}" class="nav-dropdown-item">Bar</a>
                <a href="{{ url_for('checklist.bar_closing_checklist') }}" class="nav-dropdown-item">Closing Checklist</a>
                <a href="{{ url_for('checklist.bar_glass_washer_checklist') }}" class="nav-dropdown-item">Glass Washer Checklist</a>
                <a href="{{ url_for('checklist.cold_storage_temperature_log') }}" class="nav-dropdown-item">Temperature Log</a>
                {% endif %}
                {% if current_user.user_role in ['Chef', 'Manager'] %}
                <a href="{{ url_for('checklist.kitchen_checklist') }}" class="nav-dropdown-item">Kitchen</a>
                <a href="{{ url_for('checklist.kitchen_glass_washer_checklist') }}" class="nav-dropdown-item">Glass Washer Checklist</a>
                <a href="{{ url_for('checklist.kitchen_dish_washer_checklist') }}" class="nav-dropdown-item">Dish Washer Checklist</a>
                <a href="{{ url_for('checklist.kitchen_cold_storage_temperature_log') }}" class="nav-dropdown-item">Temperature Log</a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% if current_user.is_authenticated and current_user.user_role in ['Chef', 'Bartender', 'Manager'] %}
        <div class="nav-dropdown-container">
            <span class="nav-link knowledge-dropdown-trigger" id="knowledgeDropdownTrigger">KNOWLEDGE HUB</span>
            <div class="nav-dropdown-menu" id="knowledgeDropdownMenu">
                {% if current_user.user_role in ['Bartender', 'Manager'] %}
                <a href="{{ url_for('knowledge.bartender_library') }}" class="nav-dropdown-item">Bartender Library</a>
                {% endif %}
                {% if current_user.user_role in ['Chef', 'Manager'] %}
                <a href="{{ url_for('knowledge.chef_library') }}" class="nav-dropdown-item">Chef Library</a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% if current_user.is_authenticated and current_user.user_role == 'Manager' %}
        <a href="{{ url_for('main.manage_slides') }}" class="nav-link">MANAGE SLIDES</a>
        {% endif %}
        <div class="nav-dropdown-container">
            <span class="nav-link about-dropdown-trigger" id="aboutDropdownTrigger">ABOUT</span>
            <div class="nav-dropdown-menu" id="aboutDropdownMenu">
                <a href="{{ url_for('main.about') }}" class="nav-dropdown-item">About</a>
                <a href="{{ url_for('main.contact') }}" class="nav-dropdown-item">Contact</a>
                <a href="{{ url_for('main.user_guide') }}" class="nav-dropdown-item">Need Help</a>
            </div>
        </div>
        {% if current_user.is_authenticated %}
            <div class="nav-auth">
                <div class="user-dropdown-container">
                    <div class="user-dropdown-trigger" id="userDropdownTrigger">
                        <span class="nav-welcome-small">Welcome, {{ current_user.first_name if current_user.first_name else current_user.username }}</span>
                        {% if current_user.user_role %}
                        <span class="nav-user-role">{{ current_user.user_role }}</span>
                        {% endif %}
                    </div>
                    <div class="user-dropdown-menu" id="userDropdownMenu">
                        <a href="{{ url_for('auth.profile') }}" class="user-dropdown-item">Edit Profile</a>
                        <a class="nav-logout-small user-dropdown-item" href="{{ url_for('auth.logout') }}">Logout</a>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="nav-auth">
                <a href="{{ url_for('auth.login') }}" class="nav-link">Login</a>
                <a href="{{ url_for('auth.register') }}" class="nav-link">Register</a>
            </div>
        {% endif %}
    </nav>
    </header>

    <main class="content">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="flash">
                    {% for msg in messages %}
                        <p>{{ msg }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="page-body">
            {% block page_panel %}
            <div class="page-panel">
                {% block content %}{% endblock %}
            </div>
            {% endblock %}
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Us</h3>
                <a href="mailto:soman.akhil@icloud.com">soman.akhil@icloud.com</a>
                <a href="https://wa.me/971555341989">+971 555341989</a>
            </div>
            <div class="footer-section">
                <h3>Useful Links</h3>
                <a href="{{ url_for('main.index') }}">Home</a>
                <a href="{{ url_for('main.about') }}">About Us</a>
                <a href="{{ url_for('main.contact') }}">Contact</a>
                <a href="{{ url_for('main.user_guide') }}">User Guide</a>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <p>Stay connected with us on social media</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 Chef & Bartender | Crafted by Akhil Soman üçπ</p>
        </div>
    </footer>

    <script>
    // Helper function to detect touch devices
    function isTouchDevice() {
        return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
    }
    
    // User dropdown functionality
    document.addEventListener('DOMContentLoaded', function() {
        const trigger = document.getElementById('userDropdownTrigger');
        const menu = document.getElementById('userDropdownMenu');
        
        if (trigger && menu) {
            let hoverTimeout;
            const touchDevice = isTouchDevice();
            
            // Show dropdown on hover (desktop only)
            if (!touchDevice) {
                trigger.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    menu.classList.add('show');
                });
                
                // Keep dropdown open when hovering over menu
                menu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    menu.classList.add('show');
                });
                
                // Hide dropdown when mouse leaves
                trigger.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        menu.classList.remove('show');
                    }, 200);
                });
                
                menu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        menu.classList.remove('show');
                    }, 200);
                });
            }
            
            // Click/tap toggle for mobile devices
            trigger.addEventListener('click', function(e) {
                if (touchDevice) {
                    e.preventDefault();
                    e.stopPropagation();
                    // Toggle dropdown
                    if (menu.classList.contains('show')) {
                        menu.classList.remove('show');
                    } else {
                        // Close other dropdowns first
                        document.querySelectorAll('.nav-dropdown-menu.show, .user-dropdown-menu.show').forEach(function(otherMenu) {
                            if (otherMenu !== menu) {
                                otherMenu.classList.remove('show');
                            }
                        });
                        menu.classList.add('show');
                    }
                }
            });
            
            // Close dropdown when clicking outside (mobile)
            if (touchDevice) {
                document.addEventListener('click', function(e) {
                    if (!trigger.contains(e.target) && !menu.contains(e.target)) {
                        menu.classList.remove('show');
                    }
                });
            }
        }

        // Knowledge Hub dropdown functionality
        const knowledgeTrigger = document.getElementById('knowledgeDropdownTrigger');
        const knowledgeMenu = document.getElementById('knowledgeDropdownMenu');
        
        if (knowledgeTrigger && knowledgeMenu) {
            let hoverTimeout;
            const touchDevice = isTouchDevice();
            
            // Show dropdown on hover (desktop only)
            if (!touchDevice) {
                knowledgeTrigger.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    knowledgeMenu.classList.add('show');
                });
                
                knowledgeMenu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    knowledgeMenu.classList.add('show');
                });
                
                knowledgeTrigger.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        knowledgeMenu.classList.remove('show');
                    }, 200);
                });
                
                knowledgeMenu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        knowledgeMenu.classList.remove('show');
                    }, 200);
                });
            }
            
            // Click/tap toggle for mobile devices
            knowledgeTrigger.addEventListener('click', function(e) {
                if (touchDevice) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (knowledgeMenu.classList.contains('show')) {
                        knowledgeMenu.classList.remove('show');
                    } else {
                        document.querySelectorAll('.nav-dropdown-menu.show, .user-dropdown-menu.show').forEach(function(otherMenu) {
                            if (otherMenu !== knowledgeMenu) {
                                otherMenu.classList.remove('show');
                            }
                        });
                        knowledgeMenu.classList.add('show');
                    }
                }
            });
            
            if (touchDevice) {
                document.addEventListener('click', function(e) {
                    if (!knowledgeTrigger.contains(e.target) && !knowledgeMenu.contains(e.target)) {
                        knowledgeMenu.classList.remove('show');
                    }
                });
            }
        }

        // Purchase Center dropdown functionality
        const purchaseCenterTrigger = document.getElementById('purchaseCenterDropdownTrigger');
        const purchaseCenterMenu = document.getElementById('purchaseCenterDropdownMenu');
        
        if (purchaseCenterTrigger && purchaseCenterMenu) {
            let hoverTimeout;
            const touchDevice = isTouchDevice();
            
            // Show dropdown on hover (desktop only)
            if (!touchDevice) {
                purchaseCenterTrigger.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    purchaseCenterMenu.classList.add('show');
                });
                
                purchaseCenterMenu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    purchaseCenterMenu.classList.add('show');
                });
                
                purchaseCenterTrigger.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        purchaseCenterMenu.classList.remove('show');
                    }, 200);
                });
                
                purchaseCenterMenu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        purchaseCenterMenu.classList.remove('show');
                    }, 200);
                });
            }
            
            // Click/tap toggle for mobile devices
            purchaseCenterTrigger.addEventListener('click', function(e) {
                if (touchDevice) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (purchaseCenterMenu.classList.contains('show')) {
                        purchaseCenterMenu.classList.remove('show');
                    } else {
                        document.querySelectorAll('.nav-dropdown-menu.show, .user-dropdown-menu.show').forEach(function(otherMenu) {
                            if (otherMenu !== purchaseCenterMenu) {
                                otherMenu.classList.remove('show');
                            }
                        });
                        purchaseCenterMenu.classList.add('show');
                    }
                }
            });
            
            if (touchDevice) {
                document.addEventListener('click', function(e) {
                    if (!purchaseCenterTrigger.contains(e.target) && !purchaseCenterMenu.contains(e.target)) {
                        purchaseCenterMenu.classList.remove('show');
                    }
                });
            }
        }

        // Recipe Center dropdown functionality
        const recipeCenterTrigger = document.getElementById('recipeCenterDropdownTrigger');
        const recipeCenterMenu = document.getElementById('recipeCenterDropdownMenu');
        
        if (recipeCenterTrigger && recipeCenterMenu) {
            let hoverTimeout;
            const touchDevice = isTouchDevice();
            
            // Show dropdown on hover (desktop only)
            if (!touchDevice) {
                recipeCenterTrigger.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    recipeCenterMenu.classList.add('show');
                });
                
                recipeCenterMenu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    recipeCenterMenu.classList.add('show');
                });
                
                recipeCenterTrigger.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        recipeCenterMenu.classList.remove('show');
                    }, 200);
                });
                
                recipeCenterMenu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        recipeCenterMenu.classList.remove('show');
                    }, 200);
                });
            }
            
            // Click/tap toggle for mobile devices
            recipeCenterTrigger.addEventListener('click', function(e) {
                if (touchDevice) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (recipeCenterMenu.classList.contains('show')) {
                        recipeCenterMenu.classList.remove('show');
                    } else {
                        document.querySelectorAll('.nav-dropdown-menu.show, .user-dropdown-menu.show').forEach(function(otherMenu) {
                            if (otherMenu !== recipeCenterMenu) {
                                otherMenu.classList.remove('show');
                            }
                        });
                        recipeCenterMenu.classList.add('show');
                    }
                }
            });
            
            if (touchDevice) {
                document.addEventListener('click', function(e) {
                    if (!recipeCenterTrigger.contains(e.target) && !recipeCenterMenu.contains(e.target)) {
                        recipeCenterMenu.classList.remove('show');
                    }
                });
            }
        }

        // Simple parallax effect: move background faster than foreground
        const body = document.body;
        let lastScrollY = window.pageYOffset || document.documentElement.scrollTop || 0;
        let ticking = false;

        function updateParallax(scrollY) {
            // Background moves at 2x scroll speed
            const offset = scrollY * 2;
            body.style.backgroundPosition = `center ${offset * -1}px`;
            ticking = false;
        }

        window.addEventListener('scroll', function () {
            lastScrollY = window.pageYOffset || document.documentElement.scrollTop || 0;
            if (!ticking) {
                window.requestAnimationFrame(function () {
                    updateParallax(lastScrollY);
                });
                ticking = true;
            }
        });

        // Checklist dropdown functionality
        const checklistTrigger = document.getElementById('checklistDropdownTrigger');
        const checklistMenu = document.getElementById('checklistDropdownMenu');
        
        if (checklistTrigger && checklistMenu) {
            let hoverTimeout;
            const touchDevice = isTouchDevice();
            
            // Show dropdown on hover (desktop only)
            if (!touchDevice) {
                checklistTrigger.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    checklistMenu.classList.add('show');
                });
                
                checklistMenu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    checklistMenu.classList.add('show');
                });
                
                checklistTrigger.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        checklistMenu.classList.remove('show');
                    }, 200);
                });
                
                checklistMenu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        checklistMenu.classList.remove('show');
                    }, 200);
                });
            }
            
            // Click/tap toggle for mobile devices
            checklistTrigger.addEventListener('click', function(e) {
                if (touchDevice) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (checklistMenu.classList.contains('show')) {
                        checklistMenu.classList.remove('show');
                    } else {
                        document.querySelectorAll('.nav-dropdown-menu.show, .user-dropdown-menu.show').forEach(function(otherMenu) {
                            if (otherMenu !== checklistMenu) {
                                otherMenu.classList.remove('show');
                            }
                        });
                        checklistMenu.classList.add('show');
                    }
                }
            });
            
            if (touchDevice) {
                document.addEventListener('click', function(e) {
                    if (!checklistTrigger.contains(e.target) && !checklistMenu.contains(e.target)) {
                        checklistMenu.classList.remove('show');
                    }
                });
            }
        }

        // About dropdown functionality
        const aboutTrigger = document.getElementById('aboutDropdownTrigger');
        const aboutMenu = document.getElementById('aboutDropdownMenu');
        
        if (aboutTrigger && aboutMenu) {
            let hoverTimeout;
            const touchDevice = isTouchDevice();
            
            // Show dropdown on hover (desktop only)
            if (!touchDevice) {
                aboutTrigger.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    aboutMenu.classList.add('show');
                });
                
                aboutMenu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    aboutMenu.classList.add('show');
                });
                
                aboutTrigger.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        aboutMenu.classList.remove('show');
                    }, 200);
                });
                
                aboutMenu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(function() {
                        aboutMenu.classList.remove('show');
                    }, 200);
                });
            }
            
            // Click/tap toggle for mobile devices
            aboutTrigger.addEventListener('click', function(e) {
                if (touchDevice) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (aboutMenu.classList.contains('show')) {
                        aboutMenu.classList.remove('show');
                    } else {
                        document.querySelectorAll('.nav-dropdown-menu.show, .user-dropdown-menu.show').forEach(function(otherMenu) {
                            if (otherMenu !== aboutMenu) {
                                otherMenu.classList.remove('show');
                            }
                        });
                        aboutMenu.classList.add('show');
                    }
                }
            });
            
            if (touchDevice) {
                document.addEventListener('click', function(e) {
                    if (!aboutTrigger.contains(e.target) && !aboutMenu.contains(e.target)) {
                        aboutMenu.classList.remove('show');
                    }
                });
            }
        }

        // Scroll-triggered animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Helper function to check if element is in viewport
        function isInViewport(element) {
            const rect = element.getBoundingClientRect();
            return (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }

        // Observe elements for scroll animations (exclude tables to avoid hiding them)
        const animatedElements = document.querySelectorAll('.page-panel, .panel-header, .btn-category');
        animatedElements.forEach(function(el) {
            // Check if element is already in viewport
            if (isInViewport(el)) {
                // Already visible, skip animation
                return;
            }
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(el);
        });

        // Parallax effect for hero section
        const heroSection = document.querySelector('.hero-section');
        if (heroSection) {
            window.addEventListener('scroll', function() {
                const scrolled = window.pageYOffset;
                const heroImage = heroSection.querySelector('.hero-image');
                if (heroImage && scrolled < heroSection.offsetHeight) {
                    heroImage.style.transform = 'translateY(' + (scrolled * 0.5) + 'px)';
                }
            });
        }
    });
    </script>
</body>
</html>

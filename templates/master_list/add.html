{% extends "base.html" %}
{% block page_panel %}
<h2>Add New Product</h2>

<form method="POST" enctype="multipart/form-data">
    <div class="form-table-wrapper">
    <div class="form-two-column form-two-column-wide">
        <table class="form-table">
            <tr>
                <th id="label-unique-item"><label for="unique_item_number">Unique Item Number</label></th>
                <td><input type="text" id="unique_item_number" name="unique_item_number" placeholder="ITEM-000001" title="Unique Item Number" aria-labelledby="label-unique-item" aria-label="Unique Item Number"></td>
            </tr>
            <tr>
                <th id="label-description"><label for="description">Description</label></th>
                <td><input type="text" id="description" name="description" required placeholder="Product description" title="Description" aria-labelledby="label-description" aria-label="Description"></td>
            </tr>
            <tr>
                <th id="label-supplier"><label for="supplier">Supplier</label></th>
                <td><input type="text" id="supplier" name="supplier" placeholder="Supplier Name" title="Supplier" aria-labelledby="label-supplier" aria-label="Supplier"></td>
            </tr>
            <tr>
                <th id="label-category"><label for="category">Category</label></th>
                <td>
                    <select id="category" name="category" title="Category" aria-labelledby="label-category" aria-label="Category">
                        <option value="Beverage">Beverage</option>
                        <option value="Food">Food</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th id="label-item-level"><label for="item_level">Item Level</label></th>
                <td>
                    <select id="item_level" name="item_level" required title="Item Level" aria-labelledby="label-item-level" aria-label="Item Level">
                        <option value="Primary">Primary Item</option>
                        <option value="Secondary">Secondary Item</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th id="label-sub-category"><label for="sub_category">Sub-Category</label></th>
                <td>
                    <select id="sub_category" name="sub_category" title="Sub-Category" aria-labelledby="label-sub-category" aria-label="Sub-Category">
                        <option value="">Select Sub-Category</option>
                        <!-- Options will be populated dynamically based on category -->
                    </select>
                </td>
            </tr>
            <tr>
                <th id="label-quantity"><label for="ml_in_bottle">Quantity</label></th>
                <td><input type="number" id="ml_in_bottle" step="0.01" name="ml_in_bottle" value="0" placeholder="0" title="Quantity" aria-labelledby="label-quantity" aria-label="Quantity"></td>
            </tr>
        </table>

        <table class="form-table">
            <tr>
                <th id="label-abv"><label for="abv_percent">ABV %</label></th>
                <td><input type="number" id="abv_percent" step="0.01" name="abv_percent" value="0" placeholder="0" title="ABV %" aria-labelledby="label-abv" aria-label="ABV %"></td>
            </tr>
            <tr>
                <th id="label-selling-unit"><label for="selling_unit">Selling Unit</label></th>
                <td>
                    <select id="selling_unit" name="selling_unit" required title="Selling Unit" aria-labelledby="label-selling-unit" aria-label="Selling Unit">
                        <option value="ml">ml</option>
                        <option value="grams">grams</option>
                        <option value="pieces">pieces</option>
                        <option value="cups">cups</option>
                        <option value="each">each</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th id="label-cost-per-unit"><label for="cost_per_unit">Cost per Unit (AED)</label></th>
                <td><input type="number" id="cost_per_unit" step="0.01" name="cost_per_unit" required placeholder="0.00" title="Cost per Unit (AED)" aria-labelledby="label-cost-per-unit" aria-label="Cost per Unit (AED)"></td>
            </tr>
            <tr>
                <th id="label-purchase-type"><label for="purchase_type">Purchase Type</label></th>
                <td>
                    <select id="purchase_type" name="purchase_type" title="Purchase Type" aria-labelledby="label-purchase-type" aria-label="Purchase Type">
                        <option value="each">each</option>
                        <option value="case">case</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th id="label-bottles-per-case"><label for="bottles_per_case">Bottles per Case</label></th>
                <td><input type="number" id="bottles_per_case" name="bottles_per_case" value="1" placeholder="1" title="Bottles per Case" aria-labelledby="label-bottles-per-case" aria-label="Bottles per Case"></td>
            </tr>
            <tr>
                <th id="label-product-image"><label for="image">Product Image</label></th>
                <td><input type="file" id="image" name="image" accept="image/*" title="Product Image" placeholder="Select image file" aria-labelledby="label-product-image" aria-label="Product Image"></td>
            </tr>
        </table>
    </div>
    </div>

    <div class="actions">
        <button type="submit" class="btn">Save Product</button>
        <a href="{{ url_for('products.ingredients_master') }}" class="btn secondary">Cancel</a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('category');
    const subCategorySelect = document.getElementById('sub_category');
    
    // Beverage subcategories (matching AI integration categories)
    const beverageSubcategories = [
        'American Whiskey',
        'Amaro',
        'Areated Beverage',
        'Armagnac',
        'Brandy',
        'Calvados',
        'Cognac',
        'Fresh Berry',
        'Fresh Juice',
        'Frozen Berry',
        'Frozen Puree',
        'Gin',
        'Grappa',
        'Indian Whisky',
        'Irish Whiskey',
        'Japanese Whiskey',
        'Liqueur',
        'Non Alcoholic Beer',
        'Non Alcoholic Beverage',
        'Non Alcoholic Wine',
        'Other Whisky',
        'Packet Juice',
        'Pisco',
        'Puree',
        'Red Wine',
        'Rose Wine',
        'Rum',
        'Scotch Blended Whisky',
        'Scotch Single Malt',
        'Soft Beverage',
        'Sparkling Wine',
        'Syrup',
        'Tequila',
        'Vermouth',
        'Vodka',
        'Water',
        'White Wine'
    ].sort();
    
    // Food subcategories (matching AI integration categories)
    const foodSubcategories = [
        'Chocolate',
        'Coffee',
        'Cheese',
        'Dry Fruits',
        'Dry Goods',
        'Dry Nuts',
        'Egg',
        'Fish',
        'Flower',
        'Fresh Herbs',
        'Fruit',
        'Herb',
        'Jam',
        'Juice',
        'Meat',
        'Milk',
        'Molecular',
        'Nuts',
        'Plant base Milk',
        'Puree',
        'Salt',
        'Seafood',
        'Seed',
        'Shell Fish',
        'Spice',
        'Sugar',
        'Syrup',
        'Tea',
        'Vegetable',
        'Yoghurt'
    ].sort();
    
    function updateSubCategoryOptions() {
        const selectedCategory = categorySelect.value;
        const currentValue = subCategorySelect.value;
        
        // Clear existing options except the first "Select" option
        while (subCategorySelect.options.length > 1) {
            subCategorySelect.remove(1);
        }
        
        if (selectedCategory === 'Beverage') {
            // Add beverage subcategories (already sorted)
            beverageSubcategories.forEach(function(subcat) {
                const option = document.createElement('option');
                option.value = subcat;
                option.textContent = subcat;
                option.className = 'beverage-option';
                if (subcat === currentValue) {
                    option.selected = true;
                }
                subCategorySelect.appendChild(option);
            });
        } else if (selectedCategory === 'Food') {
            // Add food subcategories (already sorted)
            foodSubcategories.forEach(function(subcat) {
                const option = document.createElement('option');
                option.value = subcat;
                option.textContent = subcat;
                option.className = 'food-option';
                if (subcat === currentValue) {
                    option.selected = true;
                }
                subCategorySelect.appendChild(option);
            });
        } else {
            // Default: show Other
            const option = document.createElement('option');
            option.value = 'Other';
            option.textContent = 'Other';
            if (currentValue === 'Other') {
                option.selected = true;
            }
            subCategorySelect.appendChild(option);
        }
    }
    
    // Update on page load
    updateSubCategoryOptions();
    
    // Update when category changes
    categorySelect.addEventListener('change', function() {
        updateSubCategoryOptions();
    });
});
</script>
{% endblock %}


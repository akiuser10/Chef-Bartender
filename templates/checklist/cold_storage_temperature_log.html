{% extends "base.html" %}
{% block page_panel %}
<div class="panel-header">
    <h2>Cold Storage Temperature Log – Unit Wise (HACCP)</h2>
</div>

<div class="cold-storage-container">
    <!-- Unit Selection and Management -->
    <div class="unit-selection-section">
        <div class="unit-controls">
            <div class="unit-select-wrapper">
                <label for="unit-select">Select Unit:</label>
                <select id="unit-select" class="unit-select">
                    <option value="">-- Select a Unit --</option>
                    {% for unit in units %}
                    <option value="{{ unit.id }}" data-unit-number="{{ unit.unit_number }}" 
                            data-location="{{ unit.location }}" data-unit-type="{{ unit.unit_type }}"
                            data-min-temp="{{ unit.min_temp }}" data-max-temp="{{ unit.max_temp }}">
                        {{ unit.unit_number }} - {{ unit.location }} ({{ unit.unit_type }})
                    </option>
                    {% endfor %}
                </select>
            </div>
            <button id="manage-units-btn" class="btn-secondary">Manage Units</button>
            <button id="generate-pdf-btn" class="btn-primary" style="display: none;">Generate PDF</button>
        </div>
    </div>

    <!-- Unit Log Display -->
    <div id="unit-log-section" style="display: none;">
        <!-- Unit Header -->
        <div class="unit-header">
            <div class="unit-header-row">
                <div class="unit-header-item">
                    <strong>UNIT NO:</strong> <span id="display-unit-number">—</span>
                </div>
                <div class="unit-header-item">
                    <strong>LOCATION:</strong> <span id="display-location">—</span>
                </div>
            </div>
            <div class="unit-header-row">
                <div class="unit-header-item">
                    <strong>UNIT TYPE:</strong> <span id="display-unit-type">—</span>
                </div>
            </div>
        </div>

        <!-- Date Selection -->
        <div class="date-selection-section">
            <label for="log-date">Date:</label>
            <input type="date" id="log-date" value="{{ today.isoformat() }}" class="date-input">
            <button id="prev-date-btn" class="btn-icon">◀</button>
            <button id="next-date-btn" class="btn-icon">▶</button>
            <button id="today-btn" class="btn-secondary">Today</button>
        </div>

        <!-- Date Display -->
        <div class="date-display">
            <strong>DATE:</strong> <span id="display-date">—</span>
        </div>

        <!-- Temperature Log Table -->
        <div class="temperature-log-table-wrapper">
            <table class="temperature-log-table" id="temperature-log-table">
                <thead>
                    <tr>
                        <th>TIME</th>
                        <th>TEMPERATURE (°C)</th>
                        <th>CORRECTIVE ACTION</th>
                        <th>INITIAL</th>
                    </tr>
                </thead>
                <tbody id="temperature-log-tbody">
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Supervisor Verification -->
        <div class="supervisor-verification" id="supervisor-verification-section" style="display: none;">
            <div class="verification-info">
                <strong>Verified by:</strong> <span id="supervisor-name">—</span>
                <strong>Date:</strong> <span id="verification-date">—</span>
            </div>
        </div>

        <!-- Save Button -->
        <div class="action-buttons">
            <button id="verify-log-btn" class="btn-primary" style="display: none;">Verify Log</button>
        </div>
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="empty-state">
        <p>Please select a unit to view or create temperature logs.</p>
    </div>
</div>

<!-- Unit Management Modal -->
<div id="unit-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Manage Units</h3>
            <button class="modal-close" id="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div id="unit-list-container">
                <!-- Unit list will be populated here -->
            </div>
            <button id="add-unit-btn" class="btn-primary">Add New Unit</button>
        </div>
    </div>
</div>

<!-- Add/Edit Unit Form Modal -->
<div id="unit-form-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="unit-form-title">Add Unit</h3>
            <button class="modal-close" id="unit-form-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="unit-form">
                <input type="hidden" id="unit-id" name="unit_id">
                <div class="form-group">
                    <label for="unit-number">Unit Number *</label>
                    <input type="text" id="unit-number" name="unit_number" required>
                </div>
                <div class="form-group">
                    <label for="unit-location">Location *</label>
                    <input type="text" id="unit-location" name="location" required>
                </div>
                <div class="form-group">
                    <label for="unit-type">Unit Type *</label>
                    <select id="unit-type" name="unit_type" required>
                        <option value="">-- Select Type --</option>
                        <option value="Refrigerator">Refrigerator</option>
                        <option value="Freezer">Freezer</option>
                        <option value="Wine Chiller">Wine Chiller</option>
                    </select>
                </div>
                <div class="form-group" id="wine-chiller-temps" style="display: none;">
                    <label for="min-temp">Minimum Temperature (°C)</label>
                    <input type="number" id="min-temp" name="min_temp" step="0.1">
                    <label for="max-temp">Maximum Temperature (°C)</label>
                    <input type="number" id="max-temp" name="max_temp" step="0.1">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save</button>
                    <button type="button" class="btn-secondary" id="cancel-unit-form">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- PDF Generation Modal -->
<div id="pdf-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Generate PDF Report</h3>
            <button class="modal-close" id="pdf-modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="pdf-form">
                <div class="form-group">
                    <label>Report Type:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="report_type" value="daily" checked> Single Date</label>
                        <label><input type="radio" name="report_type" value="weekly"> Week Range</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pdf-start-date">Start Date *</label>
                    <input type="date" id="pdf-start-date" name="start_date" required>
                </div>
                <div class="form-group" id="pdf-end-date-group" style="display: none;">
                    <label for="pdf-end-date">End Date *</label>
                    <input type="date" id="pdf-end-date" name="end_date">
                </div>
                <div class="form-group">
                    <label>Select Units:</label>
                    <div id="pdf-unit-checkboxes">
                        <!-- Checkboxes will be populated by JavaScript -->
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Generate PDF</button>
                    <button type="button" class="btn-secondary" id="cancel-pdf">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='cold_storage_temperature_log.js') }}"></script>
{% endblock %}

{% extends "base.html" %}
{% block page_panel %}
<div class="panel-header">
    <h2>Weekly Cold Storage Temperature Log – HACCP Compliant</h2>
    <p style="color: #d45a2a; font-weight: bold; margin-top: 5px;">CCP (Critical Control Point)</p>
</div>

<div class="page-panel">
    <div class="section-container">
        <div style="margin-bottom: 30px;">
            <a href="{{ url_for('checklist.weekly_log') }}" class="btn btn-primary" style="margin-right: 10px;">Create New Weekly Log</a>
            <a href="{{ url_for('checklist.manage_units') }}" class="btn btn-secondary">Manage Units</a>
        </div>

        <div class="info-box" style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Current Units</h3>
            {% if units %}
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                    {% for unit in units %}
                    <div style="background: white; padding: 12px; border-radius: 6px; border-left: 4px solid #4CAF50;">
                        <strong>{{ unit.unit_number }}</strong>
                        {% if unit.unit_name %}<br><small>{{ unit.unit_name }}</small>{% endif %}
                        <br><span style="color: #666; font-size: 0.9em;">{{ unit.unit_type }}</span>
                        {% set min_temp, max_temp = unit.get_temp_range() %}
                        {% if min_temp is not none and max_temp is not none %}
                        <br><span style="color: #666; font-size: 0.85em;">Range: {{ min_temp }}°C to {{ max_temp }}°C</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No units configured. <a href="{{ url_for('checklist.manage_units') }}">Add units</a> to start logging temperatures.</p>
            {% endif %}
        </div>

        {% if week_dates %}
        <div class="info-box" style="background: #fff9e6; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Recent Weekly Logs</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                {% for week_date in week_dates[:10] %}
                <a href="{{ url_for('checklist.view_weekly_log', week_start=week_date.strftime('%Y-%m-%d')) }}" 
                   class="btn" 
                   style="background: #fff; border: 1px solid #ddd; padding: 8px 15px; text-decoration: none; border-radius: 4px;">
                    Week of {{ week_date.strftime('%b %d, %Y') }}
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="info-box" style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
            <h3 style="margin-top: 0; color: #1976D2;">HACCP Compliance Requirements</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <p><strong>Critical Limits (CCP):</strong></p>
                    <ul style="line-height: 1.8; margin: 5px 0;">
                        <li><strong>Refrigerator:</strong> 0°C to 4°C</li>
                        <li><strong>Freezer:</strong> -12°C to -22°C</li>
                        <li><strong>Wine Chiller:</strong> User-defined target range</li>
                    </ul>
                    <p><strong>Monitoring Frequency:</strong> 4 times daily</p>
                    <ul style="line-height: 1.8; margin: 5px 0;">
                        <li>10:00 AM</li>
                        <li>02:00 PM</li>
                        <li>06:00 PM</li>
                        <li>10:00 PM</li>
                    </ul>
                </div>
                <div>
                    <p><strong>HACCP Requirements:</strong></p>
                    <ul style="line-height: 1.8; margin: 5px 0;">
                        <li>✓ <strong>Monitoring:</strong> Record all temperatures</li>
                        <li>✓ <strong>Corrective Actions:</strong> Mandatory for out-of-range temperatures</li>
                        <li>✓ <strong>Verification:</strong> Daily verification + Weekly supervisor review</li>
                        <li>✓ <strong>Record Keeping:</strong> Printable PDF for audit purposes</li>
                        <li>✓ <strong>Tamper-Evident:</strong> Records can be locked after supervisor sign-off</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>Weekly logs:</strong> Monday to Sunday</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

